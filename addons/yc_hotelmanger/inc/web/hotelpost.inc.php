<?php/* * To change this license header, choose License Headers in Project Properties. * To change this template file, choose Tools | Templates * and open the template in the editor. */global $_GPC;global $_W;if (!$this->seearr) {    message('请先配置基本设置!', $this->createWebUrl('Setting'), 'success');}if ($_POST) {    $thumbs = $_GPC['thumbs'];    $district = $_GPC['district'];    $baidumap = $_GPC['baidumap'];    $show_device_array = $_GPC['show_device'];    $id = $_GPC['id'];    $url = $this->createWebUrl('hotelList');    $data = array('uniacid' => $this->_weid, 'listorder' => $_GPC['listorder'], 'title' => $_GPC['title'], 'thumb' => $_GPC['thumb'], 'level' => $_GPC['level'], 'phone' => $_GPC['phone'],'hexiaomima' => $_GPC['hexiaomima'], 'address' => $_GPC['address'], 'province' => $district['province'], 'city' => $district['city'], 'district' => $district['district'], 'lng' => $baidumap['lng'], 'lat' => $baidumap['lat'], 'description' => $_GPC['description'], 'content' => $_GPC['content'], 'traffic' => $_GPC['traffic'], 'integral' => intval($_GPC['integral']),'sales' => $_GPC['sales'], 'status' => $_GPC['status']);    if ($show_device_array) {        $devices = array();        foreach ($_GPC['device'] as $key => $device) {            if ($device != '') {                $devices[] = array('value' => $device, 'isshow' => intval($show_device_array[$key]));            }        }        $data['show_device'] = ((empty($devices) ? '' : iserializer($devices)));    }    $data['thumbs'] = ((empty($thumbs) ? '' : iserializer($thumbs)));    if ($id) {        $where['uniacid'] = $this->_weid;        $where['id'] = $id;        if (pdo_update($this->hotel, $data, $where) === false) {            message('酒店信息更新失败!', $url, 'error');            return;        }        message("酒店信息更新成功!", $url, 'success');        return;    }    $result = pdo_insert($this->hotel, $data);    if ($result) {        message('酒店信息保存成功!', $url, 'success');        return;    }    message("酒店信息保存失败!", $url, 'error');    return;}$devices = array(    array('isdel' => 0, 'value' => '有线上网'),    array('isdel' => 0, 'isshow' => 0, 'value' => 'WIFI无线上网'),    array('isdel' => 0, 'isshow' => 0, 'value' => '可提供早餐'),    array('isdel' => 0, 'isshow' => 0, 'value' => '免费停车场'),    array('isdel' => 0, 'isshow' => 0, 'value' => '会议室'),    array('isdel' => 0, 'isshow' => 0, 'value' => '健身房'),    array('isdel' => 0, 'isshow' => 0, 'value' => '游泳池'));$id = intval($_GPC['id']);if ($id) {    $where['uniacid'] = $this->_weid;    $where['id'] = $id;    $item = pdo_fetch('SELECT * FROM ' . tablename($this->hotel) . 'WHERE  uniacid = ' . $this->_weid . ' and id =' . $id);    !count($item) && message('酒店信息不存在或以删除!', $url, 'error');    if (empty($item['show_device'])) {        $devices = array(            array('isdel' => 0, 'value' => '有线上网'),            array('isdel' => 0, 'isshow' => 0, 'value' => 'WIFI无线上网'),            array('isdel' => 0, 'isshow' => 0, 'value' => '可提供早餐'),            array('isdel' => 0, 'isshow' => 0, 'value' => '免费停车场'),            array('isdel' => 0, 'isshow' => 0, 'value' => '会议室'),            array('isdel' => 0, 'isshow' => 0, 'value' => '健身房'),            array('isdel' => 0, 'isshow' => 0, 'value' => '游泳池')        );    } else {        $devices = iunserializer($item['show_device']);    }    $piclist = iunserializer($item['thumbs']);}include $this->template($this->temp_url . 'post');
webpackJsonp([6],{XldQ:function(t,e){},qRf9:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=o("Gu7T"),a=o.n(s),i=o("Dd8w"),d=o.n(i),l=o("NYxO"),c=o("mzkE"),r=o("NPH5"),n=o("RoZr"),g=o("Vr3d"),v=o("MHEY"),h={name:"reserveGoods",data:function(){return{store:{is_rest:0,activity:{num:0}},activetabs:0,swiper_dots:!1,tabswiperable:!0,is_rest:0,status:{options_show:!1,not_in_time_show:!1,cart_show:!1},vanColHeight:0,commentHeight:0,loading:!1,goodsLoading:!1,finished:!1,categorySelectedIndex:0,categorySelectedId:0,categoryAll:[],categorySelected:[],childSelectedIndex:0,childSelectedId:0,goodsAll:[],goodsItem:{orderby:{type:"",value:""}},recommend_stores:{},coupon:[],shopPage:{},cart:{num:0},template:2,table_category:{}}},components:{PublicFooter:c.a,Load:r.a,StoreCart:n.a,GoodsHandle:g.a,StoreHeader:v.a},methods:d()({},Object(l.b)(["replaceStore","replaceCart"]),{onToggleCategory:function(t,e,o){var s=0;"child"==o?(s=e,this.childSelectedIndex=s,this.categoryAll[this.categorySelectedIndex].childSelectedIndex=s,this.categorySelected=this.categoryAll[this.categorySelectedIndex]):(this.categoryAll[e].childSelectedIndex>0&&(s=this.categoryAll[e].childSelectedIndex),this.categorySelected=this.categoryAll[e],this.categorySelectedIndex=e,this.categoryAll[e].childSelectedIndex=s),this.categorySelectedId=this.categorySelected.id,this.childSelectedId=0,this.categorySelected.child&&(this.childSelectedId=this.categorySelected.child[s].id),this.onGetGoods()},onGetGoods:function(){var t=this;if(this.goodsLoading)return!1;if(this.goodsAll[this.categorySelectedIndex]?this.goodsItem=this.goodsAll[this.categorySelectedIndex][this.childSelectedIndex]:this.goodsItem=this.goodsAll[this.categorySelectedIndex],this.goodsItem){if(this.goodsItem.empty)return!1;if(this.goodsItem.loaded)return console.log("商品全部加载完成"),!1}else this.goodsItem={page:1,psize:5,empty:0,loaded:!1,data:[],orderby:{type:"",value:""}};this.goodsLoading=!0,alert(this.store.id),this.util.request({url:"wmall/store/reserve/goods",data:{sid:this.store.id,page:this.goodsItem.page,psize:this.goodsItem.psize,cid:this.categorySelectedId,child_id:this.childSelectedId,type:this.goodsItem.orderby.type,value:this.goodsItem.orderby.value}}).then(function(e){t.goodsLoading=!1;var o=e.data.message.message;t.goodsItem.data=[].concat(a()(t.goodsItem.data),a()(o.goods)),t.goodsItem.page++,o.goods.length<t.goodsItem.psize&&(t.goodsItem.loaded=!0,o.goods.length||(t.goodsItem.empty=1)),t.goodsAll[t.categorySelectedIndex]||(t.goodsAll[t.categorySelectedIndex]=[]),t.goodsAll[t.categorySelectedIndex][t.childSelectedIndex]=t.goodsItem})},onOrderby:function(t,e){this.goodsItem={page:1,psize:5,empty:0,data:[],orderby:{type:t,value:e}},this.goodsAll[this.categorySelectedIndex][this.childSelectedIndex]=this.goodsItem,this.onGetGoods()},onLoad:function(){var t=this;console.log("---"),console.log(this.reserveExtra),this.util.request({url:"wmall/store/reserve/goodsIndex",data:{table_cid:this.reserveExtra.cid,forceLocation:"1",sid:"3"}}).then(function(e){var o=e.data.message;if(o.errno)return t.$toast(o.message),!1;o=o.message,t.goodsItem={page:2,psize:5,empty:0,data:o.goods,orderby:{type:"",value:""}},t.goodsItem.data.length<t.goodsItem.psize&&(t.goodsItem.loaded=!0,t.goodsItem.data.length||(t.goodsItem.empty=1)),t.categorySelectedId=o.cid,t.childSelectedId=o.child_id,t.store=o.store,t.coupon=o.coupon,t.categoryAll=o.category,t.table_category=o.table_category,t.is_rest=o.store.is_rest,t.goodsAll[t.categorySelectedIndex]=[],t.goodsAll[t.categorySelectedIndex][t.childSelectedIndex]=t.goodsItem,t.categorySelected=o.category[t.categorySelectedIndex],t.replaceStore(o.store),t.replaceCart(o.cart.message.cart)})}}),watch:{icart:function(){var t=this.icart.data,e=this.categoryAll;if(t)for(var o in e)if(e[o].total=0,e[o].child)for(var s in e[o].child){e[o].child[s].total=0;var a=0,i=0;for(var d in t)for(var l in t[d])t[d][l].cid==e[o].id&&(i+=t[d][l].num,e[o].total=i,t[d][l].child_id==e[o].child[s].id&&(a+=t[d][l].num,e[o].child[s].total=a))}else{i=0;for(var d in t)for(var l in t[d])t[d][l].cid==e[o].id&&(i+=t[d][l].num,e[o].total=i)}else for(var o in e)if(e[o].total=0,e[o].child)for(var s in e[o].child)e[o].child[s].total=0;this.categoryAll=e}},computed:d()({},Object(l.c)(["istore","icart","reserveExtra"])),mounted:function(){this.onLoad();var t=document.documentElement.clientHeight,e=document.getElementsByClassName("header")[0].clientHeight,o=document.getElementsByClassName("store-tabs")[0].clientHeight;this.vanColHeight=t-e-o-50}},m={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"reserve-goods"}},[o("store-header",{attrs:{store:t.store}}),t._v(" "),o("div",{staticClass:"store-tabs flex-lr van-hairline--bottom"},[o("div",{staticClass:"tab-item active"},[t._v("商品")]),t._v(" "),o("router-link",{staticClass:"tab-item",attrs:{to:t.util.getUrl({path:"/pages/store/comment?sid="+t.store.id}),tag:"div"}},[t._v("评价")]),t._v(" "),o("router-link",{staticClass:"tab-item",attrs:{to:t.util.getUrl({path:"/pages/store/index?sid="+t.store.id}),tag:"div"}},[t._v("商家")])],1),t._v(" "),o("div",{staticClass:"goods-container"},[o("van-row",[o("van-col",{style:{height:t.vanColHeight+"px"},attrs:{span:"6"}},[o("van-badge-group",{staticClass:"tabs-list",attrs:{"active-key":t.categorySelectedIndex}},[t._l(t.categoryAll,function(e,s){return[e.total>0?o("van-badge",{attrs:{title:e.title,info:e.total},on:{click:function(o){t.onToggleCategory(e.id,s,"")}}}):o("van-badge",{attrs:{title:e.title},on:{click:function(o){t.onToggleCategory(e.id,s,"")}}})]})],2)],1),t._v(" "),o("van-col",{style:{height:t.vanColHeight+"px"},attrs:{span:"18"}},[o("van-list",{attrs:{finished:t.goodsItem.loaded,offset:50,"immediate-check":!1},on:{load:t.onGetGoods}},[t.coupon.id>0&&1==t.couponStatus?o("div",{staticClass:"coupon-show-container"},[o("div",{staticClass:"coupon-price"},[t._v("\n\t\t\t\t\t\t\t¥"),o("div",[t._v(t._s(t.coupon.price))])]),t._v(" "),o("div",{staticClass:"coupon-detail"},[o("div",{staticClass:"coupon-title"},[t._v("商家代金券")]),t._v(" "),o("div",{staticClass:"coupon-desc"},[t._v("内含"+t._s(t.coupon.num)+"张券")])]),t._v(" "),o("div",{staticClass:"coupon-fetch",on:{click:t.onCollectCoupon}},[t._v("去领取")])]):t._e(),t._v(" "),t._e(),t._v(" "),t.categorySelected.child?[t.categorySelected.child.length>0?o("div",{staticClass:"tag2-list"},t._l(t.categorySelected.child,function(e,s){return o("div",{staticClass:"tag2-item",class:{selected:s==t.childSelectedIndex},on:{click:function(o){t.onToggleCategory(e.id,s,"child")}}},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(e.title)+"\n\t\t\t\t\t\t\t\t"),e.total>0?o("div",{class:{dot:e.total}}):t._e()])})):t._e()]:t._e(),t._v(" "),o("div",{staticClass:"title border-1px-t"},[o("div",{staticClass:"title-line",staticStyle:{"{'border-color'":"'#6BBA50'}"}}),t._v("\n\t\t\t\t\t\t"+t._s(t.categorySelected.child?t.categorySelected.child[t.childSelectedIndex].title:t.categorySelected.title)+"\n\t\t\t\t\t\t"),o("div",{staticClass:"title-rank"},[o("div",{staticClass:"sales ",class:{selected:"sailed"==t.goodsItem.orderby.type},on:{click:function(e){t.onOrderby("sailed","desc")}}},[t._v("销量")]),t._v(" "),o("div",{staticClass:"shu"},[t._v("|")]),t._v(" "),o("div",{staticClass:"price-container"},[o("div",{staticClass:"price"},[t._v("价格")]),t._v(" "),o("div",{staticClass:"triangle",on:{click:function(e){t.onOrderby("price","desc"==t.goodsItem.orderby.value?"asc":"desc")}}},[o("div",{staticClass:"triangle-top",class:{selected:"price"==t.goodsItem.orderby.type&&"asc"==t.goodsItem.orderby.value}}),t._v(" "),o("div",{staticClass:"triangle-bottom ",class:{selected:"price"==t.goodsItem.orderby.type&&"desc"==t.goodsItem.orderby.value}})])])])]),t._v(" "),2==t.template?t._l(t.goodsItem.data,function(e,s){return t.goodsItem.data.length>0?o("div",{staticClass:"goods clearfix border-1px-b"},[o("router-link",{staticClass:"image-box",attrs:{to:t.util.getUrl({path:"./goodsDetail",query:{id:e.id,sid:t.store.id}})}},[o("img",{directives:[{name:"lazy",rawName:"v-lazy",value:{src:e.thumb,loading:""},expression:"{src: item.thumb, loading: ''}"}],staticClass:"pic"}),t._v(" "),e.label?o("div",{staticClass:"label"},[t._v(t._s(e.label))]):t._e()]),t._v(" "),o("div",{staticClass:"shop-info clearfix"},[o("div",{staticClass:"name ellipsis"},[t._v(t._s(e.title))]),t._v(" "),o("div",{staticClass:"description"},[t._v(t._s(e.content))]),t._v(" "),o("div",{staticClass:"sold"},[t._v("已售"+t._s(e.sailed)+" 赞"+t._s(e.comment_good))]),t._v(" "),o("div",{staticClass:"price"},[o("div",{staticClass:"now-price"},[o("div",{staticClass:"price-icon"},[t._v("￥")]),t._v(t._s(e.price)+"\n\t\t\t\t\t\t\t\t\t")]),t._v(" "),e.old_price?o("div",{staticClass:"old-price"},[o("div",{staticClass:"price-icon"},[t._v("￥")]),t._v(t._s(e.old_price)+"\n\t\t\t\t\t\t\t\t\t")]):t._e()]),t._v(" "),o("div",{staticClass:"discount"},[e.discount?[o("van-icon",{attrs:{name:"tag"}}),t._v("\n\t\t\t\t\t\t\t\t\t\t"+t._s(e.discount)+"折 限"+t._s(e.max_buy_limit)+"份\n\t\t\t\t\t\t\t\t\t")]:t._e()],2)]),t._v(" "),o("goods-handle",{attrs:{store:t.store,goods:e,optionId:0,from:"list"}}),t._v(" "),o("div",{staticStyle:{clear:"both"}})],1):t._e()}):t._e(),t._v(" "),1==t.goodsItem.empty?o("load",{attrs:{type:"loaded",text:"暂无商品"}}):t.goodsItem.loaded?o("load",{attrs:{type:"loaded",text:"已经到底了"}}):t._e(),t._v(" "),t.goodsLoading?o("load",{attrs:{type:"loading"}}):t._e()],2)],1)],1)],1),t._v(" "),o("store-cart",{attrs:{show:0==t.activetabs,store:t.store,cart:t.cart,table_category:t.table_category,from:"reserve"}})],1)},staticRenderFns:[]};var _=o("VU/8")(h,m,!1,function(t){o("XldQ")},null,null);e.default=_.exports}});
//# sourceMappingURL=6.def14b155079327b7197.js.map